!function(){const{Component:e,Fragment:t}=wp.element,{PluginSidebar:s,PluginSidebarMoreMenuItem:a}=wp.editPost,{PanelBody:n,PanelRow:i,Button:r,Spinner:c,Notice:o}=wp.components,{registerPlugin:l}=wp.plugins,{__:d,sprintf:u}=wp.i18n,{select:g,subscribe:m}=wp.data;l("saga-consistency-status",{render:class extends e{constructor(e){super(e),this.state={issues:[],isLoading:!1,score:null,status:null,lastUpdate:null,error:null,dismissedIssues:[]},this.checkInterval=null,this.unsubscribe=null}componentDidMount(){this.loadIssues(),jQuery(document).on("saga:consistency-updated",(e,t)=>{this.setState({score:t.score,status:t.status,lastUpdate:new Date})}),this.unsubscribe=m(()=>{const e=g("core/editor").isSavingPost(),t=g("core/editor").isAutosavingPost();!this.wasSaving||e||t||this.loadIssues(),this.wasSaving=e})}componentWillUnmount(){this.checkInterval&&clearInterval(this.checkInterval),this.unsubscribe&&this.unsubscribe(),jQuery(document).off("saga:consistency-updated")}loadIssues=()=>{"undefined"!=typeof sagaConsistency&&sagaConsistency.entityId&&(this.setState({isLoading:!0,error:null}),jQuery.ajax({url:sagaConsistency.ajaxUrl,type:"GET",data:{action:"saga_get_entity_issues",nonce:sagaConsistency.nonce,entity_id:sagaConsistency.entityId},success:e=>{e.success?this.setState({issues:e.data.issues||[],isLoading:!1,lastUpdate:new Date}):this.setState({error:e.data?.message||d("Failed to load issues","saga-manager-theme"),isLoading:!1})},error:(e,t,s)=>{this.setState({error:d("Unable to connect to server","saga-manager-theme"),isLoading:!1})}}))};handleCheckNow=()=>{window.SagaConsistencyChecker&&(window.SagaConsistencyChecker.checkNow(),setTimeout(()=>this.loadIssues(),2e3))};handleResolve=e=>{jQuery.ajax({url:sagaConsistency.ajaxUrl,type:"POST",data:{action:"saga_resolve_issue",nonce:sagaConsistency.nonce,issue_id:e},success:e=>{e.success&&this.loadIssues()}})};handleDismiss=e=>{const{dismissedIssues:t}=this.state;jQuery.ajax({url:sagaConsistency.ajaxUrl,type:"POST",data:{action:"saga_dismiss_inline_warning",nonce:sagaConsistency.nonce,issue_id:e},success:s=>{s.success&&this.setState({dismissedIssues:[...t,e]})}})};getSeverityColor=e=>{const t={critical:"#dc2626",high:"#f59e0b",medium:"#3b82f6",low:"#10b981",info:"#6b7280"};return t[e]||t.info};getSeverityIcon=e=>{const t={critical:"ðŸ”´",high:"ðŸŸ ",medium:"ðŸ”µ",low:"ðŸŸ¢",info:"â„¹ï¸"};return t[e]||t.info};renderScoreBadge=()=>{const{score:e,status:t}=this.state;if(null===e)return null;const s={excellent:"#10b981",good:"#3b82f6",fair:"#f59e0b",poor:"#dc2626"}[t]||"#6b7280";return React.createElement("div",{style:{padding:"12px",marginBottom:"12px",backgroundColor:s+"20",border:`2px solid ${s}`,borderRadius:"8px",textAlign:"center"}},React.createElement("div",{style:{fontSize:"32px",fontWeight:"bold",color:s}},e,"%"),React.createElement("div",{style:{fontSize:"14px",color:s,textTransform:"uppercase"}},t))};renderIssue=e=>{const{dismissedIssues:t}=this.state;return t.includes(e.id)?null:React.createElement("div",{key:e.id,style:{marginBottom:"12px",padding:"12px",backgroundColor:"#f9fafb",border:`1px solid ${this.getSeverityColor(e.severity)}30`,borderLeft:`4px solid ${this.getSeverityColor(e.severity)}`,borderRadius:"4px"}},React.createElement("div",{style:{marginBottom:"8px"}},React.createElement("span",{style:{marginRight:"8px"}},this.getSeverityIcon(e.severity)),React.createElement("strong",{style:{color:this.getSeverityColor(e.severity)}},e.severity_label),React.createElement("span",{style:{marginLeft:"8px",fontSize:"12px",color:"#6b7280"}},e.type_label)),React.createElement("div",{style:{fontSize:"14px",marginBottom:"8px"}},e.description),e.suggested_fix&&React.createElement("div",{style:{fontSize:"13px",padding:"8px",backgroundColor:"#fff",borderRadius:"4px",marginBottom:"8px"}},React.createElement("strong",null,d("Suggested Fix:","saga-manager-theme")),React.createElement("div",null,e.suggested_fix)),e.ai_confidence&&React.createElement("div",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"8px"}},u(d("AI Confidence: %d%%","saga-manager-theme"),Math.round(100*e.ai_confidence))),React.createElement("div",{style:{display:"flex",gap:"8px"}},React.createElement(r,{isSmall:!0,variant:"primary",onClick:()=>this.handleResolve(e.id)},d("Resolve","saga-manager-theme")),React.createElement(r,{isSmall:!0,variant:"secondary",onClick:()=>this.handleDismiss(e.id)},d("Dismiss","saga-manager-theme"))))};renderIssuesBySeverity=()=>{const{issues:e}=this.state;if(0===e.length)return React.createElement(o,{status:"success",isDismissible:!1},d("No consistency issues found","saga-manager-theme"));const s={};return e.forEach(e=>{s[e.severity]||(s[e.severity]=[]),s[e.severity].push(e)}),React.createElement(t,null,["critical","high","medium","low","info"].map(e=>{const t=s[e];return t&&0!==t.length?React.createElement(n,{key:e,title:u(d("%s (%d)","saga-manager-theme"),e.charAt(0).toUpperCase()+e.slice(1),t.length),initialOpen:"critical"===e||"high"===e},t.map(e=>this.renderIssue(e))):null}))};render(){const{isLoading:e,error:l,lastUpdate:g,issues:m}=this.state;return React.createElement(t,null,React.createElement(a,{target:"saga-consistency-sidebar"},d("Consistency Status","saga-manager-theme")),React.createElement(s,{name:"saga-consistency-sidebar",title:d("Consistency Status","saga-manager-theme"),icon:"shield-alt"},React.createElement(n,{initialOpen:!0},this.renderScoreBadge(),React.createElement(i,null,React.createElement(r,{variant:"secondary",onClick:this.handleCheckNow,disabled:e,style:{width:"100%"}},e?React.createElement(t,null,React.createElement(c,null),d("Checking...","saga-manager-theme")):d("Check Now","saga-manager-theme"))),g&&React.createElement(i,null,React.createElement("small",{style:{color:"#6b7280"}},u(d("Last checked: %s","saga-manager-theme"),g.toLocaleTimeString()))),l&&React.createElement(o,{status:"error",isDismissible:!1},l)),!e&&this.renderIssuesBySeverity(),React.createElement(n,{title:d("About","saga-manager-theme"),initialOpen:!1},React.createElement("p",{style:{fontSize:"13px",color:"#6b7280"}},d("Consistency checks run automatically as you edit. Issues are detected using rule-based analysis and AI assistance.","saga-manager-theme")),React.createElement(r,{variant:"link",href:sagaConsistency.dashboardUrl||"#",target:"_blank"},d("View Full Dashboard","saga-manager-theme")))))}},icon:"shield-alt"})}();