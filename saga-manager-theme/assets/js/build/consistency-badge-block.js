!function(){const{registerBlockType:e}=wp.blocks,{InspectorControls:a,useBlockProps:t}=wp.blockEditor,{PanelBody:s,SelectControl:n,ToggleControl:l,RangeControl:o}=wp.components,{useSelect:r}=wp.data,{useState:c,useEffect:i}=wp.element,{__:g}=wp.i18n;e("saga/consistency-badge",{apiVersion:2,title:g("Consistency Badge","saga-manager-theme"),description:g("Display consistency score for an entity","saga-manager-theme"),category:"saga-manager",icon:"shield-alt",keywords:[g("consistency","saga-manager-theme"),g("quality","saga-manager-theme"),g("score","saga-manager-theme")],attributes:{entityId:{type:"number",default:0},showIssueCount:{type:"boolean",default:!0},showLabel:{type:"boolean",default:!0},size:{type:"string",default:"medium"},autoDetect:{type:"boolean",default:!0}},example:{attributes:{entityId:1,showIssueCount:!0,showLabel:!0}},edit:function(e){const{attributes:m,setAttributes:d}=e,{entityId:u,showIssueCount:p,showLabel:h,size:y,autoDetect:b}=m,[x,f]=c(null),[E,w]=c(0),[C,R]=c("loading"),[v,I]=c(!1),S=t(),k=r(e=>e("core/editor").getCurrentPostId(),[]);i(()=>{const e=b?k:u;e&&"undefined"!=typeof sagaConsistency&&(I(!0),jQuery.ajax({url:sagaConsistency.ajaxUrl,type:"GET",data:{action:"saga_get_entity_issues",nonce:sagaConsistency.nonce,entity_id:e},success:function(e){if(e.success){const a=e.data.issues||[],t=z(a),s=L(t);f(t),w(a.length),R(s)}I(!1)},error:function(){R("error"),I(!1)}}))},[u,b,k]);const z=e=>{const a={critical:25,high:15,medium:8,low:3,info:1};let t=0;return e.forEach(e=>{a[e.severity]&&(t+=a[e.severity])}),Math.max(0,100-t)},L=e=>e>=90?"excellent":e>=75?"good":e>=50?"fair":"poor",N=(e=>{const a={excellent:"#10b981",good:"#3b82f6",fair:"#f59e0b",poor:"#dc2626",loading:"#6b7280",error:"#dc2626"};return a[e]||a.loading})(C),B=(e=>{const a={excellent:g("Excellent","saga-manager-theme"),good:g("Good","saga-manager-theme"),fair:g("Fair","saga-manager-theme"),poor:g("Poor","saga-manager-theme"),loading:g("Loading...","saga-manager-theme"),error:g("Error","saga-manager-theme")};return a[e]||a.loading})(C),D=(e=>{const a={small:"saga-badge-small",medium:"saga-badge-medium",large:"saga-badge-large"};return a[e]||a.medium})(y);return React.createElement(React.Fragment,null,React.createElement(a,null,React.createElement(s,{title:g("Badge Settings","saga-manager-theme")},React.createElement(l,{label:g("Auto-detect Entity","saga-manager-theme"),help:g("Automatically use current post as entity","saga-manager-theme"),checked:b,onChange:e=>d({autoDetect:e})}),!b&&React.createElement(o,{label:g("Entity ID","saga-manager-theme"),value:u,onChange:e=>d({entityId:e}),min:0,max:1e4}),React.createElement(l,{label:g("Show Issue Count","saga-manager-theme"),checked:p,onChange:e=>d({showIssueCount:e})}),React.createElement(l,{label:g("Show Status Label","saga-manager-theme"),checked:h,onChange:e=>d({showLabel:e})}),React.createElement(n,{label:g("Badge Size","saga-manager-theme"),value:y,options:[{label:g("Small","saga-manager-theme"),value:"small"},{label:g("Medium","saga-manager-theme"),value:"medium"},{label:g("Large","saga-manager-theme"),value:"large"}],onChange:e=>d({size:e})}))),React.createElement("div",S,React.createElement("div",{className:`saga-consistency-badge ${D} status-${C}`,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"small"===y?"6px 12px":"large"===y?"12px 20px":"8px 16px",backgroundColor:N+"20",border:`2px solid ${N}`,borderRadius:"8px",fontFamily:"system-ui, -apple-system, sans-serif"}},React.createElement("div",{className:"score-circle",style:{width:"small"===y?"40px":"large"===y?"60px":"50px",height:"small"===y?"40px":"large"===y?"60px":"50px",borderRadius:"50%",backgroundColor:N,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"small"===y?"14px":"large"===y?"20px":"16px",fontWeight:"bold"}},v?"...":null!==x?`${x}%`:"--"),React.createElement("div",{className:"badge-content"},h&&React.createElement("div",{className:"status-label",style:{fontSize:"small"===y?"12px":"large"===y?"16px":"14px",fontWeight:"600",color:N,textTransform:"uppercase",letterSpacing:"0.5px"}},B),p&&!v&&E>0&&React.createElement("div",{className:"issue-count",style:{fontSize:"small"===y?"11px":"large"===y?"13px":"12px",color:"#6b7280"}},E," ",g(1===E?"issue":"issues","saga-manager-theme")))),b&&React.createElement("p",{style:{fontSize:"12px",color:"#6b7280",marginTop:"8px"}},g("Auto-detecting current entity","saga-manager-theme"))))},save:function(e){const{attributes:a}=e,{entityId:s,showIssueCount:n,showLabel:l,size:o,autoDetect:r}=a,c=t.save();return React.createElement("div",c,React.createElement("div",{className:"saga-consistency-badge-placeholder","data-entity-id":r?"auto":s,"data-show-issue-count":n,"data-show-label":l,"data-size":o},React.createElement("div",{className:"saga-badge-loading"},g("Loading consistency score...","saga-manager-theme"))))}})}();